<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TicketApp (Twig)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0b1020;
      --surface: #11162a;
      --muted: #8a90a2;
      --text: #e8ecf8;
      --primary: #6ea8ff;
      --green: #22c55e;
      --amber: #f59e0b;
      --gray: #9ca3af;
      --danger: #ef4444;
      --maxw: 1440px;
      --radius: 14px;
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
    }
    * { 
      box-sizing: border-box; 
    }
    html, body { 
      margin:0; 
      height:100%; 
      background: var(--bg); 
      color: var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; 
    }
    a { 
      color: inherit; text-decoration: none; 
    }
    button { 
      cursor: pointer; 
    }
    .container { max-width: var(--maxw); 
      margin: 0 auto; 
      padding: 0 24px; 
    }
    header { 
      position: sticky; 
      top:0; 
      z-index: 50; 
      backdrop-filter: blur(6px); background: rgba(11,16,32,0.7); 
      border-bottom: 1px solid rgba(255,255,255,0.06); 
    }
    .nav { 
      display:flex; align-items:center; justify-content:space-between; height:64px; 
    }
    .brand { 
      display:flex; 
      gap:10px; 
      align-items:center; font-weight:700; letter-spacing:0.4px; 
    }
    .brand .dot { 
      width:10px; 
      height:10px; border-radius:999px; background: var(--primary); box-shadow:0 0 0 4px rgba(110,168,255,0.2); 
    }
    .navlinks { 
      display:flex; 
      gap:16px; 
    }
    .navlinks a, .navlinks button { padding:8px 12px; border-radius:10px; 
    border:1px solid transparent; background: transparent; color: var(--text); 
  }
    .navlinks a:hover, .navlinks button:hover { 
      background: rgba(255,255,255,0.06); 
    }
    .btn { 
      background: var(--primary); color:#0b1020; border:none; padding:10px 16px; border-radius:12px; font-weight:600; 
    }
    .btn.secondary { 
      background: transparent; color: var(--text); border:1px solid rgba(255,255,255,0.12); 
    }
    main { 
      min-height: calc(100vh - 220px); 
    }
    footer { 
      border-top:1px solid rgba(255,255,255,0.06); 
      padding:24px 0; 
      color: var(--muted); 
    }

    /* Hero */
    .hero { 
      position: relative; 
      overflow: hidden; 
      padding: 72px 0 80px; 
    }
    .hero .bg { 
      position:absolute; 
      inset:0; 
      background: radial-gradient(1200px 600px at 20% -10%, rgba(110,168,255,0.35), transparent), radial-gradient(900px 500px at 90% -20%, rgba(34,197,94,0.18), transparent); 
      pointer-events: none; 
      z-index: 0; 
    }
    .hero .circle { position:absolute; 
      width:180px; 
      height:180px; border-radius:999px; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.6), rgba(110,168,255,0.4)); 
      top:20px; 
      right:6%; filter: blur(2px); 
      opacity:0.6; 
      z-index: 1; 
    }
    .hero .circle2 {   position:absolute; 
      width:90px;
      height:90px; border-radius:999px; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.5), rgba(34,197,94,0.35)); 
      bottom:18%; 
      left:8%; 
      opacity:0.55; z-index: 1; 
    }
    .hero .content { position:relative; 
      z-index: 2; 
      display:grid; 
      gap:18px; 
      text-align:center; }
    .hero h1 { 
      font-size: clamp(28px, 4.5vw, 48px); 
      margin:0; 
    }
    .hero p { 
      color: var(--muted); 
      margin:0 auto; 
      max-width: 820px; 
    }
    .cta { 
      display:flex; 
      gap:12px; justify-content:center; flex-wrap:wrap; margin-top:12px; 
    }
    .wave { 
      position:absolute; bottom:-1px; 
      left:0; 
      right:0; 
      height:120px; 
      z-index: 0; 
      pointer-events: none; 
    }

    /* Cards */
    .grid { 
      display:grid; 
      gap:16px; 
    }
    @media(min-width: 768px){ 
      .grid.cols-3 { grid-template-columns: repeat(3, 1fr); 
      } 
    }
    .card { 
      background: var(--surface); border:1px solid rgba(255,255,255,0.06); 
      border-radius: var(--radius); padding:16px; 
      box-shadow: var(--shadow); }
    .shadow-soft { 
      box-shadow: 0 6px 18px rgba(0,0,0,0.25); 
    }

    /* Forms */
    form { 
      display:grid; 
      gap:12px; 
    }
    label { 
      font-weight:600; 
    }
    input, select, textarea {  width:100%; 
      background:#0d1326; color:var(--text); border:1px solid rgba(255,255,255,0.12); border-radius:10px; padding:10px 12px; outline:none; 
    }
    input:focus, select:focus, textarea:focus { 
      border-color: var(--primary); box-shadow: 0 0 0 4px rgba(110,168,255,0.15); 
    }
    .error { 
      color:#fecaca; 
      font-size: 12px; 
    }

    /* Status tags */
    .tag { 
      display:inline-flex; align-items:center; 
      gap:6px; padding:4px 8px; border-radius:999px; font-size:12px; 
      border:1px solid rgba(255,255,255,0.1); 
    }
    .tag.open { 
      background: rgba(34,197,94,0.12); 
      color:#86efac; 
    }
    .tag.in_progress { 
      background: rgba(245,158,11,0.12); 
      color:#fcd34d; 
    }
    .tag.closed { 
      background: rgba(156,163,175,0.12); 
      color:#e5e7eb; 
    }

    /* Toasts */
    .toasts { 
      position: fixed; 
      top: 12px; 
      right: 12px; 
      display:grid; 
      gap:8px; 
      z-index:9999; 
    }
    .toast { 
      background: #0d1326; 
      color: var(--text); 
      border:1px solid rgba(255,255,255,0.12); 
      padding:10px 12px; border-radius:10px; box-shadow: var(--shadow); 
    }

    /* Responsive nav */
    .menu { 
      display:none; 
    }
    @media(max-width: 640px){ 
      .navlinks { 
        display:none; 
      } 
      .menu{ 
        display:block;
      } 
    }
  </style>
</head>
<body>
  <div id="app"></div>
  <div class="toasts" id="toasts" aria-live="polite" aria-atomic="true"></div>

  <script src="https://unpkg.com/twig/twig.min.js"></script>
  <script>
    const allowedStatuses = ['open','in_progress','closed'];
    const SESSION_KEY = 'ticketapp_session';
    const TICKETS_KEY = 'ticketapp_tickets';

    function getSession(){ try{return JSON.parse(localStorage.getItem(SESSION_KEY));}catch{return null;} }
    function setSession(sess){ localStorage.setItem(SESSION_KEY, JSON.stringify(sess)); }
    function clearSession(){ localStorage.removeItem(SESSION_KEY); }

    function getTickets(){ try{return JSON.parse(localStorage.getItem(TICKETS_KEY))||[];}catch{return [];} }
    function setTickets(list){ localStorage.setItem(TICKETS_KEY, JSON.stringify(list)); }

    function toast(msg){ const wrap=document.getElementById('toasts'); const el=document.createElement('div'); el.className='toast'; el.textContent=msg; wrap.appendChild(el); setTimeout(()=>el.remove(),2600); }

    function route(){ return location.hash.replace('#','') || '/'; }

    // Templates
    const layoutTpl = `
<header>
  <div class="container nav">
    <div class="brand" role="banner" aria-label="TicketApp">
      <div class="dot" aria-hidden="true"></div>
      <a href="#/">TicketApp</a>
    </div>
    <button class="menu btn secondary" aria-label="Menu" onclick="toast('Use navigation links on larger screens.')">☰</button>
    <nav class="navlinks" aria-label="Primary">
      <a href="#/">Home</a>
      <a href="#/dashboard">Dashboard</a>
      <a href="#/tickets">Tickets</a>
      {% if session %}
        <button class="btn secondary" onclick="logout()">Logout</button>
      {% else %}
        <a class="btn" href="#/auth/login">Login</a>
      {% endif %}
    </nav>
  </div>
</header>
<main>
  {{ content|raw }}
</main>
<footer>
  <div class="container">© ${new Date().getFullYear()} TicketApp. All rights reserved.</div>
</footer>`;

    const heroTpl = `
<section class="hero" aria-label="Welcome">
  <div class="bg" aria-hidden="true"></div>
  <div class="circle" aria-hidden="true"></div>
  <div class="circle2" aria-hidden="true"></div>
  <div class="container content">
    <h1>Ship better support with TicketApp</h1>
    <p>Multi-framework demo app for managing tickets with a consistent, accessible design. Explore the same UX built in React, Vue, and Twig.</p>
    <div class="cta">
      <a class="btn" href="#/auth/login">Login</a>
      <a class="btn secondary" href="#/auth/signup">Get Started</a>
    </div>
  </div>
  <svg class="wave" viewBox="0 0 1440 120" preserveAspectRatio="none" aria-hidden="true">
    <path fill="#0b1020" d="M0,32L40,58.7C80,85,160,139,240,149.3C320,160,400,128,480,106.7C560,85,640,75,720,80C800,85,880,107,960,112C1040,117,1120,107,1200,90.7C1280,75,1360,53,1400,42.7L1440,32L1440,0L1400,0C1360,0,1280,0,1200,0C1120,0,1040,0,960,0C880,0,800,0,720,0C640,0,560,0,480,0C400,0,320,0,240,0C160,0,80,0,40,0L0,0Z"/>
  </svg>
</section>`;

    const featuresTpl = `
<div class="container" style="padding:8px 0 24px">
  <div class="grid cols-3">
    <div class="card"><h3 style="margin-top:0">Fast</h3><p style="color:var(--muted)">Quickly manage your support tickets with a clean, responsive UI.</p></div>
    <div class="card"><h3 style="margin-top:0">Reliable</h3><p style="color:var(--muted)">Validation, toasts, and guards keep your data safe and clear.</p></div>
    <div class="card"><h3 style="margin-top:0">Accessible</h3><p style="color:var(--muted)">Semantic markup, focus states, and high-contrast colors.</p></div>
  </div>
</div>`;

    const loginTpl = `
<div class="container" style="padding:24px 0">
  <div class="card">
    <h2 style="margin-top:0">Welcome back</h2>
    <form onsubmit="return submitAuth(event, 'login')" novalidate>
      <div>
        <label for="email">Email</label>
        <input id="email" type="email" required aria-describedby="email-err" />
        <div id="email-err" class="error" style="display:none"></div>
      </div>
      <div>
        <label for="password">Password</label>
        <input id="password" type="password" required minlength="6" aria-describedby="pwd-err" />
        <div id="pwd-err" class="error" style="display:none"></div>
      </div>
      <div style="display:flex; gap:8px; align-items:center">
        <button class="btn" type="submit">Login</button>
        <a class="btn secondary" href="#/auth/signup">Create account</a>
      </div>
    </form>
  </div>
</div>`;

    const signupTpl = `
<div class="container" style="padding:24px 0">
  <div class="card">
    <h2 style="margin-top:0">Create your account</h2>
    <form onsubmit="return submitAuth(event, 'signup')" novalidate>
      <div>
        <label for="email">Email</label>
        <input id="email" type="email" required aria-describedby="email-err" />
        <div id="email-err" class="error" style="display:none"></div>
      </div>
      <div>
        <label for="password">Password</label>
        <input id="password" type="password" required minlength="6" aria-describedby="pwd-err" />
        <div id="pwd-err" class="error" style="display:none"></div>
      </div>
      <div style="display:flex; gap:8px; align-items:center">
        <button class="btn" type="submit">Create account</button>
        <a class="btn secondary" href="#/auth/login">Back to login</a>
      </div>
    </form>
  </div>
</div>`;

    const dashboardTpl = (stats)=>`
<div class="container" style="padding:24px 0">
  <div class="grid cols-3">
    <div class="card"><div style="opacity:.7">Total tickets</div><div style="font-size:28px; font-weight:700">${stats.total}</div></div>
    <div class="card"><div style="opacity:.7">Open</div><div style="font-size:28px; font-weight:700; color:#86efac">${stats.open}</div></div>
    <div class="card"><div style="opacity:.7">Resolved</div><div style="font-size:28px; font-weight:700; color:#e5e7eb">${stats.closed}</div></div>
  </div>
  <div class="card" style="margin-top:16px">
    <h3 style="margin-top:0">Quick actions</h3>
    <div style="display:flex; gap:8px; flex-wrap:wrap">
      <a class="btn" href="#/tickets">Manage Tickets</a>
    </div>
  </div>
</div>`;

    const ticketsTpl = (tickets)=>`
<div class="container" style="padding:24px 0">
  <div class="card" style="margin-bottom:16px">
    <div style="display:flex; justify-content:space-between; align-items:center">
      <h3 style="margin-top:0">Tickets</h3>
      <button class="btn" onclick="startCreate()">Create Ticket</button>
    </div>
    <div id="createArea" style="display:none; margin-top:12px"></div>
  </div>
  <div class="grid" style="grid-template-columns:repeat(auto-fill, minmax(280px, 1fr))" id="ticketsGrid">
    ${tickets.length===0? '<div class="card">No tickets yet.</div>' : tickets.map(t=>ticketCardTpl(t)).join('')}
  </div>
</div>`;

    function ticketCardTpl(t){ return `
<div class="card shadow-soft" role="article" aria-labelledby="t-${t.id}">
  <div id="edit-${t.id}" style="display:none"></div>
  <div id="view-${t.id}">
    <div style="display:flex; justify-content:space-between; gap:8px; align-items:baseline">
      <h4 id="t-${t.id}" style="margin:4px 0">${t.title}</h4>
      <span class="tag ${t.status}">${t.status.replace('_',' ')}</span>
    </div>
    <p style="margin-top:8px; color:var(--muted)">${t.description || 'No description.'}</p>
    <div style="display:flex; gap:8px; margin-top:8px">
      <button class="btn secondary" onclick="startEdit('${t.id}')">Edit</button>
      <button class="btn secondary" onclick="removeTicket('${t.id}')" style="border-color:rgba(255,255,255,0.2)">Delete</button>
    </div>
  </div>
</div>`; }

    function ticketFormTpl(initial){
      const title = initial?.title||''; const status = initial?.status||'open'; const description = initial?.description||'';
      return `
<form onsubmit="return submitTicket(event, ${initial? `'${initial.id}'` : 'null'})" novalidate>
  <div>
    <label for="t-title">Title</label>
    <input id="t-title" name="title" value="${escapeHtml(title)}" aria-describedby="title-err" />
    <div id="title-err" class="error" style="display:none"></div>
  </div>
  <div>
    <label for="t-status">Status</label>
    <select id="t-status" name="status" aria-describedby="status-err">
      <option value="open" ${status==='open'?'selected':''}>open</option>
      <option value="in_progress" ${status==='in_progress'?'selected':''}>in_progress</option>
      <option value="closed" ${status==='closed'?'selected':''}>closed</option>
    </select>
    <div id="status-err" class="error" style="display:none"></div>
  </div>
  <div>
    <label for="t-desc">Description</label>
    <textarea id="t-desc" name="description" rows="4" aria-describedby="desc-err">${escapeHtml(description)}</textarea>
    <div id="desc-err" class="error" style="display:none"></div>
  </div>
  <div style="display:flex; gap:8px">
    <button class="btn" type="submit">Save</button>
    <button class="btn secondary" type="button" onclick="cancelEdit()">Cancel</button>
  </div>
</form>`;
    }

    // Rendering
    function render(content){
      const app = document.getElementById('app');
      const html = Twig.twig({ data: layoutTpl }).render({ content, session: getSession() });
      app.innerHTML = html;
    }

    function go(path){ location.hash = path; }
    window.logout = function(){ clearSession(); toast('Logged out.'); go('/'); };

    function renderHome(){ render(heroTpl + featuresTpl); }
    function renderLogin(){ render(loginTpl); }
    function renderSignup(){ render(signupTpl); }
    function renderDashboard(){ const t=getTickets(); const stats={ total:t.length, open:t.filter(x=>x.status==='open').length, closed:t.filter(x=>x.status==='closed').length }; render(dashboardTpl(stats)); }
    function renderTickets(){ render(ticketsTpl(getTickets())); }

    // Auth handlers
    window.submitAuth = function(ev, mode){ ev.preventDefault(); const email = ev.target.querySelector('#email'); const pwd = ev.target.querySelector('#password'); const errs={}; if(!email.value || !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email.value)) errs.email='Valid email required'; if(!pwd.value || pwd.value.length<6) errs.password='Password must be at least 6 characters'; setFieldError('#email-err', errs.email); setFieldError('#pwd-err', errs.password); if(Object.keys(errs).length){ toast('Invalid credentials.'); return false; } setSession({ token:'demo-token', user:{ email: email.value } }); toast(mode==='signup'?'Account created. Welcome!':'Logged in successfully.'); go('/dashboard'); return false; };

    function setFieldError(sel, msg){ const el=document.querySelector(sel); if(!el) return; if(msg){ el.textContent=msg; el.style.display='block'; } else { el.textContent=''; el.style.display='none'; } }

    // Tickets handlers
    window.startCreate = function(){ const area=document.getElementById('createArea'); area.style.display='block'; area.innerHTML = ticketFormTpl(null); };
    window.startEdit = function(id){ const t=getTickets().find(x=>x.id===id); const edit=document.getElementById('edit-'+id); const view=document.getElementById('view-'+id); if(edit&&view){ edit.innerHTML=ticketFormTpl(t); edit.style.display='block'; view.style.display='none'; } };
    window.cancelEdit = function(){ // re-render tickets page to reset states
      renderTickets(); };
    window.submitTicket = function(ev, id){ ev.preventDefault(); const f=ev.target; const title=f.title.value.trim(); const status=f.status.value; const desc=f.description.value.trim(); const errs={}; if(!title) errs.title='Title is required'; if(!allowedStatuses.includes(status)) errs.status='Invalid status'; if(desc.length>1000) errs.description='Description must be at most 1000 characters';
      setInlineError('title-err', errs.title); setInlineError('status-err', errs.status); setInlineError('desc-err', errs.description);
      if(Object.keys(errs).length){ toast('Please fix validation errors.'); return false; }
      if(id){ const list=getTickets().map(x=> x.id===id? { ...x, title, status, description: desc } : x); setTickets(list); toast('Ticket updated.'); }
      else { const newT={ id:(Date.now()+Math.random()).toString(36), title, status, description: desc }; setTickets([newT, ...getTickets()]); toast('Ticket created.'); }
      renderTickets(); return false; };
    window.removeTicket = function(id){ if(!confirm('Delete this ticket?')) return; setTickets(getTickets().filter(x=>x.id!==id)); toast('Ticket deleted.'); renderTickets(); };
    function setInlineError(id, msg){ const el=document.getElementById(id); if(!el) return; if(msg){ el.textContent=msg; el.style.display='block'; } else { el.textContent=''; el.style.display='none'; } }

    function escapeHtml(s){ return s.replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c])); }

    // Router
    function guardProtected(path){ const protectedRoutes=['/dashboard','/tickets']; if(protectedRoutes.includes(path) && !getSession()){ toast('Your session has expired — please log in again.'); go('/auth/login'); return false; } return true; }
    function handleRoute(){ const r=route(); if(!guardProtected(r)) return; if(r==='/') renderHome(); else if(r==='/auth/login') renderLogin(); else if(r==='/auth/signup') renderSignup(); else if(r==='/dashboard') renderDashboard(); else if(r==='/tickets') renderTickets(); else render('<div class="container" style="padding:24px 0">Not found</div>'); }
    addEventListener('hashchange', handleRoute);
    if(!location.hash) location.hash = '/';
    handleRoute();
  </script>
</body>
</html>
